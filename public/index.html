<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pisscord</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #1e1e2f, #12121d);
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    .card {
      background: #2b2b3c;
      border-radius: 16px;
      padding: 2rem;
      text-align: center;
      max-width: 420px;
      width: 90%;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
    }
    .avatar {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      box-shadow: 0 0 0 3px #5865f2;
      margin-bottom: 1rem;
    }
    .username {
      font-size: 1.6rem;
      font-weight: bold;
    }
    .id {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 1.5rem;
    }
    .badges {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.4rem;
      margin-top: 1rem;
    }
    .badge {
      height: 48px;
      border-radius: 6px;
      transition: transform 0.2s ease;
    }
    .badge:hover {
      transform: scale(1.1);
      filter: drop-shadow(0 0 6px #777);
    }
    #error {
      color: #ff4d4d;
      background: #1a0000;
      padding: 1rem;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <div class="card" id="content">Loading...</div>

  <script>
    const id = new URLSearchParams(location.search).get("id");
    const content = document.getElementById("content");

    const badgeIcons = {
      DISCORD_EMPLOYEE: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/staff.png",
      PARTNERED_SERVER_OWNER: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/partnered_server_owner.png",
      HYPESQUAD_EVENTS: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/hypesquad_events.png",
      BUG_HUNTER_LEVEL_1: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/bug_hunter_level_1.png",
      HOUSE_BRAVERY: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/hypesquad_bravery.png",
      HOUSE_BRILLIANCE: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/hypesquad_brilliance.png",
      HOUSE_BALANCE: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/hypesquad_balance.png",
      EARLY_SUPPORTER: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/early_supporter.png",
      BUG_HUNTER_LEVEL_2: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/bug_hunter_level_2.png",
      VERIFIED_DEVELOPER: "https://raw.githubusercontent.com/merlinfuchs/discord-badges/refs/heads/main/PNG/early_verified_developer.png"
    };

    const flagsMap = {
      1: "DISCORD_EMPLOYEE",
      2: "PARTNERED_SERVER_OWNER",
      4: "HYPESQUAD_EVENTS",
      8: "BUG_HUNTER_LEVEL_1",
      64: "HOUSE_BRAVERY",
      128: "HOUSE_BRILLIANCE",
      256: "HOUSE_BALANCE",
      512: "EARLY_SUPPORTER",
      4096: "SYSTEM",
      16384: "BUG_HUNTER_LEVEL_2",
      131072: "VERIFIED_DEVELOPER"
    };

    async function load() {
      if (!id) {
        content.innerHTML = `<div id="error">Missing <code>?id=</code> in URL.</div>`;
        return;
      }

      try {
        const [userRes, badgeRes] = await Promise.all([
          fetch(`/api?id=${id}`),
          fetch("https://obs-akuma.github.io/PisscordLookup/Badges.json") 
        ]);

        const user = await userRes.json();
        const badgeData = await badgeRes.json();

        if (user.error) {
          content.innerHTML = `<div id="error">User not found.</div>`;
          return;
        }

        const publicFlags = user.public_flags ?? 0;
        const systemBadges = Object.entries(flagsMap)
          .filter(([bit, _]) => (publicFlags & bit) != 0)
          .map(([_, name]) => badgeIcons[name])
          .filter(Boolean);

        const customBadges = (badgeData[id] || []).map(b => b.badge);

        const avatarUrl = user.avatar
          ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png`
          : `https://cdn.discordapp.com/embed/avatars/0.png`;

        let badgeImgs = "";

        if (systemBadges.length > 0 || customBadges.length > 0) {
          badgeImgs = `<div class="badges">` +
            [...systemBadges, ...customBadges]
              .map(badge => `<img class="badge" src="${badge}">`)
              .join("") +
            `</div>`;
        }

        content.innerHTML = `
          <img class="avatar" src="${avatarUrl}" alt="avatar">
          <div class="username">${user.username}${user.discriminator !== "0" ? `#${user.discriminator}` : ""}</div>
          <div class="id">${user.id}</div>
          ${badgeImgs}
        `;
      } catch (err) {
        content.innerHTML = `<div id="error">Failed to load user.</div>`;
      }
    }

    load();
  </script>
</body>
</html>
